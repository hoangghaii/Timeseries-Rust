import {
  getXDomain,
  getYDomain,
  groupsValuesList,
  preprocess,
} from '../functions'
import { config, data1, data2 } from './data-test'

describe('EupTimeseries data_preprocess test', () => {
  // Test function preprocess
  test.each([
    // valid cases
    [
      data1.groups,
      config.hiddenGroups,
      [
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.441873699426651,
          x: 0,
          y: -0.441873699426651,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4421650767326355,
          x: 1,
          y: -0.4421650767326355,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4440840780735016,
          x: 2,
          y: -0.4440840780735016,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4427724778652191,
          x: 3,
          y: -0.4427724778652191,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4430401027202606,
          x: 4,
          y: -0.4430401027202606,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.443501353263855,
          x: 5,
          y: -0.443501353263855,
        },
      ],
    ],
    [
      data2.groups,
      config.hiddenGroups,
      [
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.441873699426651,
          x: 0,
          y: -0.441873699426651,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4421650767326355,
          x: 1,
          y: -0.4421650767326355,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4440840780735016,
          x: 2,
          y: -0.4440840780735016,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4427724778652191,
          x: 3,
          y: -0.4427724778652191,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4430401027202606,
          x: 4,
          y: -0.4430401027202606,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.443501353263855,
          x: 5,
          y: -0.443501353263855,
        },
      ],
    ],

    // invalid cases
    [[], [], []],
    [undefined, undefined, []],
    [null, null, []],
  ])('Test function preprocess', (groups, hiddenGroups, expected) => {
    const r = preprocess(groups, hiddenGroups)
    expect(r).toEqual(expected)
  })

  // Test function groupsValuesList
  test.each([
    // valid cases
    [
      data1.groups,
      config.hiddenGroups,
      [
        [-0.441873699426651],
        [-0.4421650767326355],
        [-0.4440840780735016],
        [-0.4427724778652191],
        [-0.4430401027202606],
        [-0.443501353263855],
      ],
    ],
    [
      data2.groups,
      config.hiddenGroups,
      [
        [-0.441873699426651],
        [-0.4421650767326355],
        [-0.4440840780735016],
        [-0.4427724778652191],
        [-0.4430401027202606],
        [-0.443501353263855],
      ],
    ],

    // invalid cases
    [[], [], []],
    [undefined, undefined, []],
    [null, null, []],
  ])('Test function groupsValuesList', (groups, hiddenGroups, expected) => {
    const r = groupsValuesList(groups, hiddenGroups)
    expect(r).toEqual(expected)
  })

  // Test function getYDomain
  test.each([
    // valid cases
    [
      [
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.441873699426651,
          x: 0,
          y: -0.441873699426651,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4421650767326355,
          x: 1,
          y: -0.4421650767326355,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4440840780735016,
          x: 2,
          y: -0.4440840780735016,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4427724778652191,
          x: 3,
          y: -0.4427724778652191,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4430401027202606,
          x: 4,
          y: -0.4430401027202606,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.443501353263855,
          x: 5,
          y: -0.443501353263855,
        },
      ],
      { minY: -0.4441840780735016, maxY: -0.441773699426651 },
    ],
    [
      [
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.441873699426651,
          x: 0,
          y: -0.441873699426651,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4421650767326355,
          x: 1,
          y: -0.4421650767326355,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4440840780735016,
          x: 2,
          y: -0.4440840780735016,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4427724778652191,
          x: 3,
          y: -0.4427724778652191,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4430401027202606,
          x: 4,
          y: -0.4430401027202606,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.443501353263855,
          x: 5,
          y: -0.443501353263855,
        },
      ],
      { minY: -0.4441840780735016, maxY: -0.441773699426651 },
    ],

    // invalid cases
    [[], { minY: 0, maxY: 0 }],
    [undefined, { minY: 0, maxY: 0 }],
    [null, { minY: 0, maxY: 0 }],
  ])('Test function getYDomain', (data, expected) => {
    const r = getYDomain(data)
    expect(r).toEqual(expected)
  })

  // Test function getXDomain
  test.each([
    // valid cases
    [
      [
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.441873699426651,
          x: 0,
          y: -0.441873699426651,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4421650767326355,
          x: 1,
          y: -0.4421650767326355,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4440840780735016,
          x: 2,
          y: -0.4440840780735016,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4427724778652191,
          x: 3,
          y: -0.4427724778652191,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4430401027202606,
          x: 4,
          y: -0.4430401027202606,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.443501353263855,
          x: 5,
          y: -0.443501353263855,
        },
      ],
      5,
    ],
    [
      [
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.441873699426651,
          x: 0,
          y: -0.441873699426651,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4421650767326355,
          x: 1,
          y: -0.4421650767326355,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4440840780735016,
          x: 2,
          y: -0.4440840780735016,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4427724778652191,
          x: 3,
          y: -0.4427724778652191,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.4430401027202606,
          x: 4,
          y: -0.4430401027202606,
        },
        {
          keyValues: { SITE_NUM: 1 },
          color: '#3f1891',
          stats: {
            Count: 53,
            Cp: '79.9',
            Cpk: '69.0',
            Max: '−440.9mV',
            Mean: '−442.7mV',
            Min: '−445.8mV',
            Std: '834.7µV',
            cp: 79.87082415216057,
            cpk: 68.96716473570952,
            max: -0.44087716937065125,
            mean: -0.44269677827943044,
            min: -0.4457610845565796,
            std: 0.00083468110374161,
          },
          value: -0.443501353263855,
          x: 5,
          y: -0.443501353263855,
        },
      ],
      5,
    ],

    // invalid cases
    [[], 0],
    [undefined, 0],
    [null, 0],
  ])('gest function getXDomain', (data, expected) => {
    const r = getXDomain(data)
    expect(r).toEqual(expected)
  })
})
